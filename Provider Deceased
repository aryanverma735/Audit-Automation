WITH BASE AS (
SELECT *
FROM PROV P
JOIN CD_VAL C ON P.PROV_TRMNTN_RSN_CD = C.CD_VAL_CD
WHERE 
P.MSTR_PROV_ID = '1101855927'
AND P.PROV_TRMNTN_DT = TO_DATE('03/01/2025','MM/DD/YYYY')
AND UPPER(C.CD_VAL_NM) = UPPER('Provider Deceased')
)
SELECT MSTR_PROV_ID, PROV_TRMNTN_DT, CD_VAL_NM,
CASE WHEN COUNT(*) > 0  THEN 'AUDIT PASS' ELSE 'AUDIT FAIL' END AS AUDIT_RESULT
FROM BASE
GROUP BY MSTR_PROV_ID, PROV_TRMNTN_DT, CD_VAL_NM

