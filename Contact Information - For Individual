WITH BASE AS (
SELECT * FROM
RLTD_PADRS P 
JOIN RLTD_PADRS_CNTCT C ON P.RLTD_PADRS_KEY = C.RLTD_PADRS_KEY
JOIN CD_VAL CD ON C.CNTCT_PUR_CD = CD.CD_VAL_CD
WHERE P.RLTD_MSTR_PROV_ID = '1101352269'
AND P.RLTD_PADRS_KEY = '7030416966'
AND UPPER(CD.CD_VAL_NM) = UPPER('Directory Phone Number')
AND UPPER(C.PRMRY_CNTCT_INFO_IND) = UPPER('Y')
AND UPPER(C.CNFDNTL_CNTCT_IND) = UPPER('N')
AND C.CNTCT_VAL_TXT = '5106475101'
)
SELECT RLTD_MSTR_PROV_ID, CNTCT_VAL_TXT,
CASE WHEN COUNT(*) > 0 THEN 'AUDIT PASS' ELSE 'AUDIT FAIL' END AS AUDIT_RESULT
FROM BASE 
GROUP BY RLTD_MSTR_PROV_ID,CNTCT_VAL_TXT
