WITH base AS (
  SELECT
    L_IND.MSTR_PROV_ID          AS IND_MSTR_PROV_ID,
    K.MSTR_PROV_ID              AS ORG_EID,
    M.PADRS_TYPE_CD             AS PADRS_TYPE_CD,
    NW.RGNL_NTWK_ID,
    J.MIN_AGE_NBR,
    J.MAX_AGE_NBR,
    CC.CD_VAL_NM AS PAT_GNDR_NM

  FROM SPSOWNER.RLTD_PADRS_NTWK J
  JOIN CD_VAL CC 
    ON J.PAT_GNDR_CD = CC.CD_VAL_CD AND CC.CD_VAL_NM = 'Both'
  JOIN SPSOWNER.RLTD_PADRS K 
    ON K.RLTD_PADRS_KEY = J.RLTD_PADRS_KEY
  JOIN SPSOWNER.PROV L_ORG 
    ON L_ORG.MSTR_PROV_ID = K.MSTR_PROV_ID 
  JOIN SPSOWNER.PROV L_IND 
    ON L_IND.MSTR_PROV_ID = K.RLTD_MSTR_PROV_ID
  JOIN SPSOWNER.POA M 
    ON M.POA_KEY = K.POA_KEY 
  JOIN SPSOWNER.POA_NTWK N 
    ON N.POA_NTWK_KEY = J.POA_NTWK_KEY
  JOIN SPSOWNER.PROV_ORG_NTWK PON 
    ON PON.PROV_ORG_NTWK_KEY = N.PROV_ORG_NTWK_KEY
   AND PON.MSTR_PROV_ID = L_ORG.MSTR_PROV_ID
  JOIN SPSOWNER.NTWK NW 
    ON PON.NTWK_KEY = NW.NTWK_KEY
  JOIN CD_VAL C
    ON NW.NTWK_LOB_CD = C.CD_VAL_CD
  JOIN SPSOWNER.STNDRDZD_ADRS S 
    ON M.SPS_STNDRDZD_ADRS_ID = S.SPS_STNDRDZD_ADRS_ID
  WHERE 
    L_IND.MSTR_PROV_ID = '1105264605'
    AND C.CD_VAL_NM = 'Medicaid'
)
SELECT
    RGNL_NTWK_ID,
    CASE 
        WHEN SUM(
               CASE 
                 WHEN MIN_AGE_NBR <> '1'
                   OR MAX_AGE_NBR <> '18'
                   OR PAT_GNDR_NM <> 'Both'
                 THEN 1 ELSE 0 
               END
             ) > 0
        THEN 'Audit Fail'
        ELSE 'Audit Pass'
    END AS audit_result
FROM base
GROUP BY RGNL_NTWK_ID;
