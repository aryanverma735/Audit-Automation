WITH BASE AS (
SELECT 
P.MSTR_PROV_ID, 
CC.CD_VAL_NM,
C.CD_VAL_NM
FROM PROV_CRDNTLG_STTS P
JOIN CD_VAL C ON P.CRDNTLG_DATA_SOR_CD = C.CD_VAL_CD
JOIN CD_VAL CC ON P.CRDNTLG_STTS_CD = CC.CD_VAL_CD
WHERE 
P.MSTR_PROV_ID = '1101859457'
AND UPPER(C.CD_VAL_NM) = UPPER('SPS')
AND UPPER(CC.CD_VAL_NM) = UPPER('Approved')
)
SELECT 
MSTR_PROV_ID,
CASE WHEN COUNT(*) > 0 THEN 'AUDIT PASS' ELSE 'AUDIT FAIL' END AS AUDIT_RESULT
FROM BASE
GROUP BY MSTR_PROV_ID
