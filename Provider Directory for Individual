WITH base AS (
  SELECT
    L_IND.MSTR_PROV_ID          AS IND_MSTR_PROV_ID,
    K.MSTR_PROV_ID              AS ORG_EID,
    NW.RGNL_NTWK_ID,
    NW.NTWK_TRMNTN_DT,
    NW.NTWK_TRMNTN_RSN_CD,
    J.RLTD_PADRS_NTWK_EFCTV_DT,
    J.RLTD_PADRS_NTWK_TRMNTN_DT,
    J.RLTD_PADRS_NTWK_TRMNTN_RSN_CD,
    PNC.CP_TYPE_CD              AS ACPTG_PTNT_IND,
    N.MAX_MBR_CNT,
    N.POA_NTWK_TRMNTN_RSN_CD,
    J.DIR_DSPLY_IND,
    J.MIN_AGE_NBR,
    J.MAX_AGE_NBR,
    J.PAT_GNDR_CD,
    J.DIR_SPRSN_RSN_CD,
    J.ROLE_CD,
    PS.SPCLTY_CD,
    K.RLTD_PADRS_KEY            -- For filtering
  FROM SPSOWNER.RLTD_PADRS_NTWK J
  JOIN SPSOWNER.RLTD_PADRS K 
    ON K.RLTD_PADRS_KEY = J.RLTD_PADRS_KEY
  JOIN SPSOWNER.PROV L_ORG 
    ON L_ORG.MSTR_PROV_ID = K.MSTR_PROV_ID 
  JOIN SPSOWNER.PROV L_IND 
    ON L_IND.MSTR_PROV_ID = K.RLTD_MSTR_PROV_ID
  JOIN SPSOWNER.POA M 
    ON M.POA_KEY = K.POA_KEY 
  JOIN SPSOWNER.POA_NTWK N 
    ON N.POA_NTWK_KEY = J.POA_NTWK_KEY
  JOIN SPSOWNER.PROV_ORG_NTWK PON 
    ON PON.PROV_ORG_NTWK_KEY = N.PROV_ORG_NTWK_KEY
   AND PON.MSTR_PROV_ID = L_ORG.MSTR_PROV_ID
  JOIN SPSOWNER.NTWK NW 
    ON PON.NTWK_KEY = NW.NTWK_KEY
  JOIN SPSOWNER.RLTD_PADRS_NTWK_CP PNC 
    ON PNC.RLTD_PADRS_NTWK_KEY = J.RLTD_PADRS_NTWK_KEY 
  JOIN SPSOWNER.RLTD_PADRS_NTWK_SPCLTY RS
    ON J.RLTD_PADRS_NTWK_KEY = RS.RLTD_PADRS_NTWK_KEY
  JOIN PROV_SPCLTY PS
    ON RS.PROV_SPCLTY_KEY = PS.PROV_SPCLTY_KEY
  WHERE 
    L_IND.MSTR_PROV_ID = '1100177811'
    AND NW.RGNL_NTWK_ID in ('BCCHIN00','BCCHMO00','BHMOPAT1','BHMOSG00','BHMOSL00','BHMOSL01','BHMOSL02','CACC03XX','CACC11XX','CACC55XX','CACC99XX','CAHDH200','CAHDHA00','CAHPT100')
    AND J.DIR_DSPLY_IND = 'Y'
    AND K.RLTD_PADRS_KEY = '7031997395'  
)
SELECT
  base.RGNL_NTWK_ID,
  CASE WHEN COUNT(*)>0 THEN 'Audit Pass' ELSE 'Audit Fail' END AS audit_result
  FROM base
  GROUP BY base.RGNL_NTWK_ID
